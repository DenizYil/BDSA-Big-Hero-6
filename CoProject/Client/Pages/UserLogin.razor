@page "/userlogin"
@inject NavigationManager _navManager
@layout EmptyLayout
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject HttpClient _client
@using CoProject.Shared;

<PageTitle>Login - CoProject</PageTitle>

<LoadingComponent></LoadingComponent>

@code {

    protected override async void OnInitialized()
    {

        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if(user != null)
        {
            var response = await _client.PostAsJsonAsync("/api/user", "");

            if (response.IsSuccessStatusCode)
            {
                _navManager.NavigateTo("/projects");
            }
            else
            {
                _navManager.NavigateTo("/?error=" + response.Content);
            }
        }else
        {
            _navManager.NavigateTo("/?error=Not Logged In!");
        }


    }
}